// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Brand {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  logo        String
  description String
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Product {
  id                String                  @id @default(cuid())
  brandId           String
  brand             Brand                   @relation(fields: [brandId], references: [id], onDelete: Cascade)
  name              String
  slug              String
  description       String
  shortDescription  String
  category          String
  subCategory       String?   // Optional sub-category (e.g. Economy, Premium, Luxury)
  sheenLevel        String
  surfaceType       String
  usage             String
  image             String
  bannerImage       String?   // Optional hero banner image URL
  prices            Json // { "1L": 1, "4L": 1, ... } â€” 1 = available size
  sizeUnit          String?  @default("L") // "L" = Liter, "K" = KG
  colors            Json? // string[]
  features          Json? // string[]
  specifications    Json? // Record<string, string>
  pisHeading        String? // Custom heading for PIS section
  pisDescription    String? // Custom description for PIS section
  pisFileUrl        String? // URL to uploaded PDF file
  showPisSection    Boolean @default(false) // Toggle to show/hide PIS section
  userGuideSteps    Json? // Array of step objects: [{ title: string, description: string }]
  userGuideMaterials Json? // Array of material strings
  userGuideTips     Json? // Array of tip strings
  showUserGuide     Boolean @default(false) // Toggle to show/hide User Guide section
  faqs              Json? // Array of FAQ objects: [{ question: string, answer: string }]
  showFaqSection    Boolean @default(false) // Toggle to show/hide FAQ section
  relatedProducts   ProductRelatedProduct[] @relation("ProductRelations")
  relatedToProducts ProductRelatedProduct[] @relation("RelatedProductRelations")
  suggestedBlogs    ProductBlogSuggestion[]
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt

  @@unique([brandId, slug])
  @@index([brandId])
  @@index([sheenLevel])
  @@index([slug])
}

model ProductRelatedProduct {
  id              String   @id @default(cuid())
  productId       String
  relatedProductId String
  product         Product  @relation("ProductRelations", fields: [productId], references: [id], onDelete: Cascade)
  relatedProduct  Product  @relation("RelatedProductRelations", fields: [relatedProductId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now())

  @@unique([productId, relatedProductId])
  @@index([productId])
  @@index([relatedProductId])
}

model BlogPost {
  id                 String                  @id @default(cuid())
  slug               String                  @unique
  title              String
  excerpt            String                  @db.Text
  content            String                  @db.Text
  coverImage         String
  author             String
  readTime           String
  categories         Json                    // string[]
  published          Boolean                 @default(false)
  metaDescription    String?                 @db.Text
  metaKeywords       String?
  featuredOrder      Int?
  viewCount          Int                     @default(0)
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  publishedAt        DateTime?
  productSuggestions ProductBlogSuggestion[]

  @@index([slug])
  @@index([published])
  @@index([publishedAt])
  @@index([featuredOrder])
}

model ProductBlogSuggestion {
  id        String   @id @default(cuid())
  productId String
  blogId    String
  order     Int      @default(0)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  blog      BlogPost @relation(fields: [blogId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([productId, blogId])
  @@index([productId])
  @@index([blogId])
}
